**Segmentation Approaches Comparison:**

| Aspect / Step                     | **Basic** (`dino_segmentation_basic.ipynb`)                                   | **Heuristic** (`dino_segmentation_heuristic.ipynb`)                                        | **Advanced U2Seg** (`dino_segmentation_advanced_u2seg.ipynb`)                                               | Main Difference                                      |
|-----------------------------------|--------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
| Goal                              | Unsupervised silkworm **semantic + instance** segmentation                    | Same goal, but **auto-detects classes by color**                                            | Unified **two-branch** unsupervised segmentation (instances + semantics) and then merges                      | More automated & modular each step                   |
| Feature extractor                 | DINOv2 ViT-B/14 via `torch.hub`                                                | Same                                                                                        | Same                                                                                                           | No change                                            |
| Input resize                      | 518×518 (center crop/resize)                                                   | 518×518                                                                                     | 518×518                                                                                                        | Same                                                 |
| Patch grid                        | 37×37 tokens                                                                   | 37×37                                                                                       | 37×37                                                                                                          | Same                                                 |
| Semantic clustering method        | Spectral clustering (τ = 0.12) → KMeans (k = 3)                                | Same                                                                                        | Same                                                                                                           | Same base algorithm                                  |
| Who decides “silkworms/leaf/bg”?  | **Hard-coded**: cluster 0 = silkworms, others sequential                       | **HSV heuristic**: lowest saturation = silkworms; hue≈60 = leaves; leftover = background    | Same HSV heuristic                                                                                             | Manual → automatic                                   |
| Instance segmentation trigger     | Only on silkworm mask (binary)                                                 | Same                                                                                        | First build class-agnostic many instances, then classify them                                                  | U2Seg splits first, classifies later                 |
| Instance split method             | Distance transform + watershed on silkworm mask                                | Same                                                                                        | Same watershed, **after** instance clustering stage                                                             | Extra clustering stage in U2Seg                      |
| Instance “pre-groups” from clustering | ✗                                                                            | ✗                                                                                           | ✓ Spectral clustering with many clusters (~150) to get raw instances                                            | New in U2Seg                                         |
| Instance size filter              | `min_obj_size = 150` px                                                        | 150 px                                                                                      | 100 px (default shown), configurable                                                                            | Slight param tweak                                   |
| Peak separation (`min_distance`)  | 12 px                                                                          | 12 px                                                                                       | 12 px                                                                                                          | Same                                                 |
| Semantic class count              | 3                                                                              | 3                                                                                           | 3                                                                                                              | Same                                                 |
| Instance cluster count            | N/A                                                                            | N/A                                                                                         | ~150 (configurable)                                                                                             | Only U2Seg                                           |
| Merge rule (instances ↔ semantics)| N/A (only worms instanced)                                                     | N/A (only worms instanced)                                                                  | Majority-overlap vote assigns each instance to a semantic class                                                | New in U2Seg                                         |
| Visualization panels              | 3: Original / Semantic / Instance                                              | 3: Original / Semantic / Instance                                                           | 4: Original / Raw instances / Semantic / Final merged                                                          | Extra panel in U2Seg                                 |
| Output dictionary                 | `instance_masks`, `semantic_map`, `label_to_name_map`, `silkworm_count`        | Same, names auto-derived                                                                    | `raw_instances`, `classified_instances`, `category_counts`, `semantic_map`, `semantic_names`                   | Richer outputs in U2Seg                              |
| Folder creation                   | Not emphasized                                                                 | Yes, created at start                                                                       | Yes                                                                                                            | Minor housekeeping                                   |
| Saving results to disk            | No (plots only)                                                                | No (plots only)                                                                              | Paths prepared (still plots unless extended)                                                                    | Structure ready later                                |
| Hyperparameters exposed           | Few (`tau`, `n_classes`, `min_obj_size`, …)                                    | Same + HSV thresholds implicit                                                              | More (separate τ / n_clusters for instances vs semantics)                                                      | Finer control in U2Seg                               |
| Class naming robustness           | Fragile (cluster ID swap breaks it)                                            | More robust (color heuristic)                                                               | Same heuristic + instance vote adds stability                                                                   | Increasing robustness                                |
| Pipeline name                     | None                                                                           | None                                                                                        | `U2SegUnified` class                                                                                            | Formalized pipeline object                           |
| Code organization                 | Straightforward classes                                                        | Same classes + extra labeling function                                                      | Multiple specialized classes + merger class                                                                     | More modular & layered                               |
| Computational cost                | Moderate                                                                       | Moderate                                                                                    | Slightly higher (extra clustering)                                                                              | U2Seg adds spectral clustering                       |
| When worms are counted            | After silkworm mask watershed                                                  | After silkworm mask watershed                                                               | After merging classified instances → counts per class                                                           | U2Seg can count any class                            |


*Classification On Seg Masks Approaches Comparison:**

| Aspect | **Notebook 1 – `Untitled20.ipynb`** | **Notebook 2 – `FEED va no FEED.ipynb`** | Main Difference / Takeaway |
|---|---|---|---|
| Overall strategy | Two-stage training: (1) on instance crops, then (2) fine-tune on full raw images | Single-stage training: only on instance crops | N1 uses full-image context; N2 doesn’t |
| Data sources | Stage 1: cropped non-background instances from U2Seg<br>Stage 2: original full images | Cropped non-background instances only | N2 skips raw-image fine-tuning |
| Label source | Image-level labels from `0_data.csv`, propagated to each crop; same labels reused on raw images | Same propagation to crops; no raw images used | Both use CSV labels, only N1 applies them again on raws |
| Model | MobileNetV3-Small pretrained; backbone frozen, last FC replaced | Same (MobileNetV3-Small, frozen backbone, new head) | Architecture identical |
| Training epochs / LR | Stage 1: 4 epochs @ 1e-3<br>Stage 2: 3 epochs @ 1e-4 | 5 epochs @ 1e-3 (single loop) | Two LRs & phases vs one |
| Batch size | 16 (both stages) | 32 | Slightly larger batch in N2 |
| Validation split | 20% for both instance and raw datasets | 20% on instance dataset | N1 validates on raws; N2 on instances |
| Metrics reported | Confusion matrix + Accuracy, Precision, Recall, F1 (after Stage 2 on raw val set) | Confusion matrix + Accuracy, Precision, Recall, F1 **plus** Specificity & FPR (on instance val set) | N2 adds Spec/FPR; N1 reports on raw scenes |
| Data prep function | `prepare_data_for_feed_classification` (creates crops & folders) | Same function/idea (minor param diffs) | Very similar |
| Extra datasets/classes | Has a `LabeledRawImageDataset` for full images | No raw-image dataset class | Only N1 needs raw-image loader |
| Checkpointing | Not explicitly saving (folder exists) | Same | Neither saves by default |
| U2Seg usage | Full pipeline to get instances + semantic map; used twice (prep & demo) | Same pipeline; used once mainly for prep | Equal segmentation backbone |
| Instance clustering params | `n_clusters` ≈ 150, `min_size`=100, τ=0.05 (instances) | Same (copied) | Identical unsupervised seg params |
| Pros | Gains context from whole images; better potential generalization | Simpler, faster to run/train; fewer moving parts | Complexity vs simplicity trade-off |
| Cons / Risks | Longer training, more code paths; frozen backbone may cap perf | Lacks global context; crop labels may be noisy | Context vs noise |
| Best use case | When scene-level cues matter (layout, lighting) | When object appearance alone is enough & you want quick iteration | Choose based on what drives the signal |

